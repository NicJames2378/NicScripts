# Get-CisaReport.ps1
A script to scrape a [CISA Bulletin](https://www.cisa.gov/news-events/bulletins), parse the output based on a self-generated config file, and output a Word document report. This project was initially created to simplify the process of assessing vulnerabilities which are applicable to a particular network.

Requires:
- Microsoft Office Word Interop (Microsoft.Office.Interop.Word)
- Valid internet connection

As this script will update the config file each time it is ran, it is recommended to keep the config file consistent across multiple executions. Additionally, it is recommended to generate an initial config using the urls of the last 10-20 CISA Bulletins prior to creating a report. For the sake of convenience when editing, the config is a simple CSV file rather than a database.


## Parameters
| Parameter           	| Description                                                     	 | Example                                             	|
|---------------------	|------------------------------------------------------------------- |-----------------------------------------------------	|
| BulletinUrl         	| The URL of the CISA Bulletin                                    	 | https://www.cisa.gov/news-events/bulletins/sb23-338 	|
| ConfigPath          	| The file path of the config.csv                                 	 | "$($env:USERPROFILE)Desktop\config.csv"             	|
| OutputPath          	| The directory path to save outputs                              	 | "$($env:USERPROFILE)Desktop\"                       	|
| ConfigsOnly         	| If true, only outputs configs and skips generating a report     	 | $True, $False                                       	|
| BackupConfigs         | If true, makes a backup of the configs before modifying            | $True, $False                                       	|
| OmitAssignments     	| If true, skips generating an assignments table in the report    	 | $True, $False                                       	|
| OmitVulnerabilities 	| If true, skips generating a vulnerabilities table in the report 	 | $True, $False                                       	|
| BulkAssignments       | If true, consolidates non-ignored assignments (denoted with a '*') | $True, $False


## Examples:
For checking against a single bulletin:
```
.\Get-CisaReport.ps1 -ConfigPath "$($env:USERPROFILE)Desktop\config.csv" -OutputPath "$($env:USERPROFILE)Desktop\" -BulletinUrl 'https://www.cisa.gov/news-events/bulletins/sb23-338'
```

For checking against multiple bulletins:
```
$urls = @(
    'https://www.cisa.gov/news-events/bulletins/sb23-338',
    'https://www.cisa.gov/news-events/bulletins/sb23-331',
    'https://www.cisa.gov/news-events/bulletins/sb23-324'
)

$urls | ForEach-Object { .\Get-CisaReport.ps1 -ConfigPath "$($env:USERPROFILE)Desktop\config.csv" -OutputPath "$($env:USERPROFILE)Desktop\" -BulletinUrl $_ }
```

For generating a config file only:
```
$urls = @(
    'https://www.cisa.gov/news-events/bulletins/sb23-338',
    'https://www.cisa.gov/news-events/bulletins/sb23-331',
    'https://www.cisa.gov/news-events/bulletins/sb23-324'
)

$urls | ForEach-Object { .\Get-CisaReport.ps1 -ConfigsOnly -ConfigPath "$($env:USERPROFILE)Desktop\config.csv" -OutputPath "$($env:USERPROFILE)Desktop\" -BulletinUrl $_ }
```

## Generating a base config
For the sake of simplifying things, the following scriptlet can be ran to get the URLs needed for generating a base config. I recommend generating a config from at least the last 2 pages of bulletins, as that gives a well-formed baseline. Do remember that each new bulletin may have new software in it, so your config should be viewed as a 'living document' of sorts.
```
$baseUrl = 'https://www.cisa.gov/news-events/bulletins'
# Change the second number in the '0..XX' to change how many pages of Bulletins you want to parse. 
# These pages correspond to the pages of https://www.cisa.gov/news-events/bulletins, where each page contains 10 bulletins.
0..4 | ForEach-Object {
    $req = Invoke-WebRequest -Method GET -Uri ("$($baseUrl)?page=$_")
    $req.ParsedHtml.links | Where-Object { $_.outerHtml -ilike "*/news-events/bulletins/*" } | Select href | % {
        $_.href -replace 'about:','https://www.cisa.gov/'
    }
}
```

## Updating the config
Updating the config is as simple as running the script against an existing config with a new CISA Bulletin. This will add any new software to the config CSV, which can be adjusted as needed manually.

The config CSV can be updated manually as needed using any text or CSV editor. Note that Microsoft Excel has an annoying habit of occasionally changing the data in the document when you open it. This is not something that I can correct on my side, as it is an artifact of how Microsoft attempts to infer the data in each cell/column.

Products where the "IGNORED" value evaluates to TRUE will be skipped when generating a report. 

If you want to skip all products by a particular vendor, you can do so by manually creating an entry with the identifier of the vendor you want to ignore, a product of '*', and an "IGNORED" value of TRUE. See below example.

Conversely, if you want to show all products by a particular vendor (regardless of individual ignored states), you can do so by manually creating an entry with the identifier of the vendor you want to show, a product of '*', and an "IGNORED" value of FALSE. 

See below example.

| Vendor            | Product                       | Assignee  | Ignored   | Notes                                                         |
|------------------ | ----------------------------- |---------- | --------- | ------------------------------------------------------------- |
| google            | android                       | Bill      | FALSE     | This will show on reports                                     |
| sourcecodester    | *                             | Ted       | FALSE     | Will not show, due to the wildcard. Asignee doesn't matter.   |
| sourcecodester    | ac_repair_and_services_system |           | FALSE     | Will not show, due to the wildcard ignore above.              |
| apache    | ac_repair_and_services_system |           | FALSE     | Will not show, due to the wildcard ignore above.              |
| apache    | ac_repair_and_services_system |           | FALSE     | Will not show, due to the wildcard ignore above.              |


### Note
As a side note, you may see some entries with single characters, such as these:
| Vendor | Product | Assignee | Ignored | Notes |
| --- | --- | --- | --- | --- |
| a | d |  | FALSE |  |
| a | m |  | FALSE |  |
| a | p |  | FALSE |  |
| a | s |  | FALSE |  |
| a | u |  | FALSE |  |

I recommend to leave these unignored. In normal operation, they will never appear and therefore not be an issue. On rare occasions, the CISA bulletins malforms it's data before posting, resulting in vulnerability reports for products with incomplete names. If this happens and the single letter entries are ignored, you may miss important vulnerabilities!